<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peluk Virtual â€” Happy Birthday</title>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- decorative animated gradient + stickers -->
  <div class="bg-ornaments" aria-hidden="true">
    <div class="sticker s1">ğŸ°</div>
    <div class="sticker s2">ğŸŒ¸</div>
    <div class="sticker s3">ğŸŒˆ</div>
    <div class="sticker s4">âœ¨</div>
  </div>

  <div class="balloon-container" aria-hidden="true"></div>
  <canvas id="confettiCanvas"></canvas>

  <main class="container hero position-relative d-flex align-items-center justify-content-center" style="z-index:2; min-height: 100vh;">
    <div class="row w-100 align-items-center justify-content-center">
      <div class="col-lg-8 mx-auto mb-4 mb-lg-0 d-flex justify-content-center">
        <div class="card card-cute p-4 p-lg-5 w-100" style="max-width: 900px; margin: 0 auto;">
          <div class="hug-wrap position-relative flex-column">
            <div id="bearHug" class="bear mb-3" title="Klik untuk pelukan!" role="button" tabindex="0" aria-pressed="false" style="cursor:pointer; outline:none;">
              <div class="face">Ê•â€¢á´¥â€¢Ê”</div>
              <div class="eyes">( Â´ â–½ ` )</div>
            </div>
            <div class="text-center">
              <h5 class="mb-1" style="font-family: 'Comfortaa', cursive; font-size: 2rem; letter-spacing: 1px; color: #6d294c;">Peluk Virtual</h5>
              <p class="small" style="font-family: 'Comfortaa', cursive; font-size: 1.1rem; color: #b36a8a;">Klik beruang untuk mendapatkan pelukan gemes ğŸ’</p>
            </div>
          </div>
          <hr>
          <div class="d-flex gap-2 justify-content-center flex-wrap stickers-row">
            <!-- <img src="https://i.postimg.cc/ZKp4r3rG/cute-1.png" class="img-fluid rounded-3 shadow-sm sticker-thumb" style="width:110px;" alt="cute">
            <img src="https://i.postimg.cc/1Xq3Yt9P/cute-2.png" class="img-fluid rounded-3 shadow-sm sticker-thumb" style="width:110px;" alt="cute"> -->
          </div>
          <div class="d-flex flex-column gap-2 mt-3">
            <button onclick="window.location.href='index.html'" class="btn btn-outline-secondary">Kembali</button>
            <a id="nextMsgBtn" href="surat-cinta-untuk-calon-istri-tersayang.pdf" target="_blank" class="btn btn-success" style="display:none;">Sudah? Lanjut Pesannya</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- hidden audio (place hbd-music.mp3 in same folder) -->
  <audio id="localAudio" src="hbd-music.mp3" preload="auto"></audio>
  <audio id="bearSfx" src="bear-hug-sfx.mp3" preload="auto" aria-hidden="true"></audio>

  <script>
    /* confetti + bear */
    // Bear element for virtual hug
    const confettiCanvas = document.getElementById('confettiCanvas');
    const ctx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    function resizeCanvas(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeCanvas); resizeCanvas();
    function createConfetti(x,y){
      for(let i=0;i<60;i++){
        confettiPieces.push({ x: x + rand(-60,60), y: y + rand(-20,20), vx: rand(-6,6), vy: rand(-8, -2), size: rand(6,12), color: ['#FF6B9A','#FFD166','#FFB4C6','#9AD3BC'][Math.floor(rand(0,4))], rot: rand(0,360) });
      }
    }
    function updateConfetti(){
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      for(let i=confettiPieces.length-1;i>=0;i--){
        const p = confettiPieces[i]; p.vy += 0.25; p.x += p.vx; p.y += p.vy; p.rot += 8;
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot * Math.PI/180);
        ctx.fillStyle = p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
        ctx.restore(); if(p.y > confettiCanvas.height + 50) confettiPieces.splice(i,1);
      }
      requestAnimationFrame(updateConfetti);
    }
    updateConfetti();
    // Restore music state from localStorage
    window.addEventListener('DOMContentLoaded', function() {
      const audio = document.getElementById('localAudio');
      const playing = localStorage.getItem('audioPlaying') === 'true';
      const time = parseFloat(localStorage.getItem('audioTime') || '0');
      audio.currentTime = time;
      audio.volume = 0.9;
      if (playing) {
        audio.play().catch(()=>{});
      }
    });
  // Bear hug animation
    const bearHug = document.getElementById('bearHug');
    const nextMsgBtn = document.getElementById('nextMsgBtn');
    let bearClickCount = 0;
    bearHug.addEventListener('click', function(){
      bearHug.classList.add('bubble');
      setTimeout(()=> bearHug.classList.remove('bubble'), 700);
      const rect = bearHug.getBoundingClientRect();
      const pop = document.createElement('div');
      pop.style.position='fixed'; pop.style.left= (rect.left + rect.width/2 - 90)+'px'; pop.style.top=(rect.top - 24)+'px';
      pop.style.padding='8px 12px'; pop.style.background='rgba(255,255,255,0.98)'; pop.style.borderRadius='999px'; pop.style.boxShadow='0 8px 28px rgba(0,0,0,0.08)';
      pop.style.fontFamily='Comfortaa, cursive'; pop.style.color='#6d294c'; pop.style.zIndex=2000; pop.textContent = 'Peluk, sayang! ğŸ»ğŸ’•'; document.body.appendChild(pop);
      setTimeout(()=> pop.remove(),1400);
      try{ const bearSfx = document.getElementById('bearSfx'); if(bearSfx && typeof bearSfx.play === 'function'){ bearSfx.currentTime = 0; bearSfx.play().catch(()=>{}); } }catch(e){}
      bearClickCount++;
      if (bearClickCount === 3 && nextMsgBtn) {
        nextMsgBtn.style.display = '';
      }
    });
    bearHug.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ') bearHug.click(); });

    // Heart rain animation
    const rand = (min, max) => Math.random() * (max - min) + min;
    let heartInterval = null;
    function spawnHeart(){
      const heart = document.createElement('div');
      heart.className = 'heart'; heart.innerHTML = 'ğŸ’˜';
      heart.style.left = rand(2, 94) + 'vw'; heart.style.fontSize = rand(18, 42) + 'px';
      heart.style.animationDuration = rand(4,9)+'s'; heart.style.transform = `translateY(-10vh) rotate(${rand(-45,45)}deg)`;
      document.body.appendChild(heart);
      setTimeout(()=> heart.remove(), 10000);
    }
    function startHearts(){
      if(!heartInterval){ heartInterval = setInterval(spawnHeart, 300); }
    }
    function stopHearts(){
      if(heartInterval){ clearInterval(heartInterval); heartInterval = null; }
    }
    // Start heart rain automatically
    startHearts();

    // Cat-cake balloon animation
    const balloonContainer = document.querySelector('.balloon-container');
    const balloonSrcs = [ 'cat-cake.png', 'cat-cake.png', 'cat-cake.png' ];
    function spawnBalloon(){
      const img = document.createElement('img');
      img.src = balloonSrcs[Math.floor(Math.random()*balloonSrcs.length)];
      img.className = 'balloon';
      img.style.left = rand(-5, 95) + 'vw';
      img.style.width = (rand(60,120))+'px';
      img.style.animationDuration = rand(6,14)+'s';
      img.style.opacity = rand(0.85,1);
      balloonContainer.appendChild(img);
      setTimeout(()=> img.remove(), 16000);
    }
    setInterval(spawnBalloon, 900);
  </script>
</body>
</html>
